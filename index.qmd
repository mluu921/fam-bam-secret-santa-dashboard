---
format: dashboard
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r}
library(tidyverse)
library(gt)
library(networkD3)
library(pins)

board <- pins::board_folder('board')

data <- pins::pin_read(board, 'processed-data')

data <- data |> select(-budget) |> drop_na()

create_network_viz <- \(data, link_distance, charge) {
  
  nodes <- data.frame(name = unique(c(data$participants, data$matched)))  |>
    mutate(Group = row_number())
  
  links <- data |>
    mutate(
      source = match(participants, nodes$name) - 1,
      target = match(matched, nodes$name) - 1
    )  |> 
    mutate(value = 1) |> 
    as.data.frame()
  
  forceNetwork(
    Links = links,
    Nodes = nodes,
    Source = "source",
    Target = "target",
    NodeID = "name",
    Group = "Group",
    Value = 'value',
    opacity = 0.9,
    zoom = TRUE,
    fontSize = 15,
    opacityNoHover = 1,
    linkWidth = 1,
    charge = charge,
    arrows = FALSE,
    linkDistance = link_distance
  )
  
}

```

```{r}
#| results: asis

data |>
  group_nest(year) |>
  mutate(year = as.numeric(year)) |>
  arrange(desc(year)) |>
  mutate(year = as_factor(year)) |>
  deframe() |>
  imap_chr(\(data, title) {
    knitr::knit_child(
      'child-dashboard-page.qmd',
      envir = list(data = data, title = title),
      quiet = TRUE
    )
    
    
  }) |> cat(sep = '\n')

```

